<!DOCTYPE html><html lang="zh-HK">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Lucky Draw Â· CMS (Firebase)</title>
    <link rel="stylesheet" href="./styles.css"/>
    <link rel="icon" href="data:,">
    <style>.chip{display:inline-block;
      padding:4px 8px;
      border:1px solid #e3d61633;
      border-radius:999px;margin:2px}.photo{display:inline-block;margin:6px}
      </style>
      </head>
<body>
<div id="loginGate" class="overlay" style="display:none"><form id="loginForm" class="card" style="min-width:320px; background:#121a2b; padding:16px"><h3 style="margin-top:0">ç™»å…¥</h3><label>å¸³è™Ÿ <input id="loginUser" placeholder="admin"/></label><label>å¯†ç¢¼ <input id="loginPass" type="password" placeholder="admin"/></label><div class="bar" style="margin-top:12px"><button class="btn primary" type="submit">é€²å…¥</button></div></form></div>
<header><div class="container row"><div class="tabs"><button class="btn primary active" type="button">å¾Œå° CMS</button></div>
  <div class="bar" style="margin-left:auto"><button id="themeToggle" class="btn small">â˜€ï¸ Normal Mode</button>
<a class="btn" href="#" id="btnPublicBoard" role="button">Public Board â†—</a>
<a class="btn" href="./tablet.html" target="_blank" role="button">Tablet View â†—</a>
<a class="btn primary" href="./landing.html" target="_blank" role="button">Landing â†—</a>
</div></div>
</header>
<main class="container" id="cmsView"><div class="cms-grid">
<aside class="sidebar"><div class="sidebar-title">æ´»å‹•æ¸…å–®</div><div id="eventList" class="event-list"></div><hr style="border-color:rgba(255,255,255,.12)"><div class="sidebar-title">åŠŸèƒ½é é¢</div>
<nav id="cmsNav" class="nav-list">
<button class="nav-item active" data-target="pageEvent">æ´»å‹•è³‡æ–™</button>
<button class="nav-item" data-target="pageRoster">åå–®</button>
<button class="nav-item" data-target="pagePrizes">çå“</button>
<button class="nav-item" data-target="pageStageDraw">èˆå°æŠ½ç</button>
<button class="nav-item" data-target="pageQuestions">æŠ½å•</button>
<button class="nav-item" data-target="pagePoll">æŠ•ç¥¨</button>
<button class="nav-item" data-target="pageStorage">ç´ æ/æª”æ¡ˆ</button>
<button class="nav-item" data-target="pageEventsManage">æ´»å‹•ç®¡ç†</button>
<button class="nav-item" data-target="pageUsers">ä½¿ç”¨è€…</button>
</nav></aside>
<section class="cms-main">

<section class="card subpage" id="pageEvent"><h3>æ´»å‹•è³‡æ–™</h3><div class="grid-2">
<label>æ´»å‹•åç¨± <input id="metaName"/></label><label>å®¢æˆ¶åç¨± <input id="metaClient"/></label><label>æ˜¯å¦å…¬é–‹ <input id="metaListed" type="checkbox" checked/></label><label>é¡¯ç¤ºæ¨™é¡Œ <input id="evTitle"/></label><label>æ—¥æœŸæ™‚é–“ <input id="evDateTime"/></label><label>åœ°é»åç¨± <input id="evVenue"/></label><label>åœ°å€ <input id="evAddress"/></label><label>é›»è©±æ¬„ä½åç¨± <input id="evLabelPhone" placeholder="æ‰‹æ©Ÿ / é›»è©±" /></label>
<label>éƒ¨é–€æ¬„ä½åç¨± <input id="evLabelDept"  placeholder="éƒ¨é–€ / æè¿°" /></label>
<label>Google åœ°åœ–é€£çµ <input id="evMapUrl"/></label><label>å·´å£« <textarea id="evBus" rows="3"></textarea></label><label>åœ°éµ/ç«è»Š <textarea id="evTrain" rows="3"></textarea></label><label>æ³Šè»Š <textarea id="evParking" rows="3"></textarea></label><label>å‚™è¨» <textarea id="evNotes" rows="3"></textarea></label><button id="saveEventInfo" class="btn primary" type="button">ğŸ’¾ å„²å­˜</button></div></section>

<section class="card subpage" id="pageRoster" style="display:none">
  <h3>åå–® / åŒ¯å…¥</h3>

  <!-- dynamic label legend (optional) -->
  <div id="rosterLabels" class="muted" style="margin:4px 0 8px; font-size:12px;">
    <span id="hdrPhone"></span> Â· <span id="hdrDept"></span>
  </div>

  <!-- controls -->
  <div class="bar" style="gap:8px; flex-wrap:wrap">
    <input placeholder="æœå°‹å§“å/éƒ¨é–€/é›»è©±/ä»£ç¢¼/åº§ä½..." id="searchGuest" />
    <label style="margin-left:auto">æ¯é é¡¯ç¤º
      <select id="pageSize">
        <option value="50" selected>50</option>
        <option value="100">100</option>
      </select>
      ç­†
    </label>
    <span id="rosterCount"></span>
  </div>

  <input type="file" id="csvFile" accept=".csv"/>
  <div class="bar" style="margin-top:8px">
    <button id="btnImportCSV" class="btn">åŒ¯å…¥ CSV</button>
    <button id="btnExportCSV" class="btn">åŒ¯å‡º CSV</button>
    <div style="margin-left:auto; display:flex; align-items:center; gap:8px">
      <button id="prevPage" class="btn small">ä¸Šä¸€é </button>
      <span id="pageInfo" class="muted"></span>
      <button id="nextPage" class="btn small">ä¸‹ä¸€é </button>
    </div>
  </div>

  <!-- table -->
  <div style="margin-top:10px; overflow:auto">
    <table class="fullwidth" id="guestTable">
      <thead>
        <tr>
          <th data-key="checkedIn" data-sortable="true" style="width:60px">å‡ºå¸­</th>
          <th data-key="name"      data-sortable="true">å§“å</th>
          <th data-key="dept"      data-sortable="true" id="thDept">éƒ¨é–€</th>
          <th data-key="phone"     data-sortable="true" id="thPhone">é›»è©±</th>
          <th data-key="code"      data-sortable="true">ä»£ç¢¼</th>
          <th data-key="table"     data-sortable="true" style="width:80px">æ±è™Ÿ</th>
          <th data-key="seat"      data-sortable="true" style="width:80px">åº§ä½</th>
          <th data-key="prize"     data-sortable="true">çå“</th>
          <th style="width:200px">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="guestTbody"></tbody>
    </table>
  </div>
</section>

<section class="card subpage" id="pageStageDraw" style="display:none">
  <h3>èˆå°æŠ½ç</h3>

   <div class="stage-controls">
    <div id="drawBtns" class="btns">
      æ‰¹æ¬¡ï¼š
      <button class="btn small" data-batch="1">1</button>
      <button class="btn small" data-batch="2">2</button>
      <button class="btn small" data-batch="3">3</button>
      <button class="btn small" data-batch="4">4</button>
      <button class="btn small" data-batch="5">5</button>
      <button class="btn small" data-batch="6">6</button>
      <button class="btn small" data-batch="7">7</button>
      <button class="btn small" data-batch="8">8</button>
      <button class="btn small" data-batch="9">9</button>
      <button class="btn small" data-batch="10">10</button>
    </div>
<br>
    <button id="btnRollMain" class="btn" style="background:#e53935;color:#fff">é–‹å§‹æŠ½ç</button>
    <button id="btnClearScreen" class="btn" style="background:#ffd84d;color:#000000">æ¸…ç©ºç•«é¢</button>
    <button id="btnExportWinners" class="btn">åŒ¯å‡ºæœ¬çé …å¾—çåå–®</button>

    <!-- 16:9 CMS Stage (entire lucky draw UI lives inside this box) -->
<div id="cmsStage16x9" class="cms-stage">
  <!-- Header row: Logo + Banner -->
  <div class="stage-row header">
    <div id="stageLogo" class="logo-box">LOGO</div>
    <div id="stageBanner" class="banner-box">Banner space</div>
  </div>
<!-- Prize strip: two pills centered -->
<div class="stage-row prize-strip">
  <div class="spacer"></div>

  <div class="bar">
    <!-- keep the current prize as-is or also make it a .stat if you want identical look -->
    <div id="stageCurrentPrize" class="stat current-prize">
      ç¾æ­£æŠ½çï¼š<span id="stagePrizeName">â€”</span>
    </div>

    <!-- make æ­¤çå°šé¤˜ use the SAME .stat class as ç¸½äººæ•¸å°šé¤˜ -->
    <div id="prizeLeftInline" class="stat">
      æ­¤çå°šé¤˜ï¼š<span id="stagePrizeLeft">â€”</span>
    </div>
  </div>

  <div class="spacer"></div>
</div>

  <!-- Winners area: grid + backdrop countdown underneath cards -->
  <div class="stage-row winners-area stage-main">
    <div id="stageGrid"></div>
    <div id="stageCountdown"></div>
  </div>

  <!-- Footer stats (centered under grid): total remaining | total won -->
  <div class="stage-row footer-stats">
    <div id="totalLeft" class="stat">ç¸½äººæ•¸å°šé¤˜ï¼š<span id="stageTotalLeft">â€”</span></div>
    <div id="totalWon" class="stat">å·²å¾—çï¼š<span id="stageTotalWon">â€”</span></div>
  </div>
</div>
<!-- reroll record panel under the canvas -->
 
<div id="rerollLogPanel" class="reroll-log"></div>
</section>

<section class="card subpage" id="pagePrizes" style="display:none"><h3>çå“ / æŠ½ç</h3><div class="bar" style="margin-bottom:8px"><input id="newPrizeName" placeholder="çå“åç¨±"/><label>åé¡ <input type="number" id="newPrizeQuota" value="1" min="1"/></label><button id="addPrize" class="btn" type="button">+ æ–°å¢</button></div>
  <table>
   <thead>
     <tr>
       <th>ä½¿ç”¨ä¸­</th><th>çå“åç¨±</th><th>åé¡</th><th>å·²å¾—ç</th><th style="width:120px">æ“ä½œ</th>
     </tr>
   </thead>
   <tbody id="prizeRows"></tbody>
 </table>
<div class="bar"><label>æ‰¹é‡ <input id="batchCount" type="number" value="1" min="1"/></label><button id="drawBatch" class="btn">æŠ½å‡º</button></div><h4>å¾—çåå–®</h4><ul id="winnersList"></ul></section>
<section class="card subpage" id="pageQuestions" style="display:none"><h3>æŠ½å•</h3><div class="bar"><input id="newQuestion" placeholder="æ–°å¢å•é¡Œâ€¦"/><button id="btnAddQuestion" class="btn">+ æ–°å¢</button></div><ol id="questionList"></ol></section>
<section class="card subpage" id="pagePoll" style="display:none">
  <h3>æŠ•ç¥¨</h3><div class="grid-2">
    <label>é¡Œç›® 
      <!-- Current Poll Picker -->
<div class="card" style="margin-bottom:12px">
  <div class="bar" style="gap:8px;flex-wrap:wrap">
    <label class="muted">ç›®å‰åƒèˆ‡çš„å•é¡Œï¼š</label>
    <select id="pollPicker" class="input" style="min-width:280px"></select>
    <button id="btnSetCurrent" class="btn">è¨­ç‚ºç›®å‰å•é¡Œ</button>
    <button id="btnShowPickerQR" class="btn">é¡¯ç¤ºæ­¤å•é¡Œçš„ QR</button>
  </div>
</div>

      <!-- Quick Compose -->
<div class="card" style="margin-bottom:12px">
  <div class="bar" style="gap:8px; flex-wrap:wrap">
    <input id="pollQInput" class="input" placeholder="å•é¡Œï¼ˆä¾‹ï¼šä»Šæ™šæœ€å–œæ­¡çš„è¡¨æ¼”ï¼Ÿï¼‰" style="flex:1; min-width:280px" />
    <button id="btnCreatePoll" class="btn">å»ºç«‹æŠ•ç¥¨</button>
    <button id="btnClearStage" class="btn btn-secondary">æ¸…ç©ºèˆå°é¡¯ç¤º</button>
  </div>
  <div>
    <div class="muted" style="margin:6px 0">é¸é …ï¼ˆé€å€‹è¼¸å…¥ï¼ŒæŒ‰ Enter æ–°å¢ï¼‰ï¼š</div>
    <div id="optChips" class="bar" style="gap:8px; flex-wrap:wrap"></div>
    <input id="optInput" class="input" placeholder="è¼¸å…¥é¸é …å¾ŒæŒ‰ Enter" />
  </div>
</div>

<!-- Inline QR preview panel -->
<div class="bar" style="margin:10px 0">
  <div id="pollQR"></div>
</div>

<div class="card" id="pollManager">
  <div class="bar" style="justify-content:space-between;align-items:center">
    <strong>æŠ•ç¥¨ç®¡ç†</strong>
    <button id="btnAddPoll" class="btn">ï¼‹ æ–°å¢å•é¡Œ</button>
  </div>
  <ul id="pollManagerList" class="list"></ul>
</div>


<h4 style="display:none">å·²ç™¼ä½ˆ</h4>
<ul id="pollList" style="display:none"></ul>
</section>
<section class="card subpage" id="pageStorage" style="display:none"><h3>ç´ æ/æª”æ¡ˆï¼ˆURLï¼‰</h3><label>Banner URL <input id="bannerUrl"/></label><label>Logo URL <input id="logoUrl"/></label><div class="bar"><button id="saveAssets" class="btn">å„²å­˜</button> <button id="addPhoto" class="btn">+ ç›¸ç‰‡ URL</button></div><div id="photosGrid"></div></section>
<section class="card subpage" id="pageEventsManage" style="display:none"><h3>æ´»å‹•ç®¡ç†</h3><p>åœ¨å·¦å´ã€Œæ´»å‹•æ¸…å–®ã€å¯æ–°å¢æ´»å‹•ã€åˆ‡æ›æ´»å‹•ã€‚</p><div id="eventsAdmin"></div>
</section>
<section class="card subpage" id="pageUsers" style="display:none"><h3>ä½¿ç”¨è€…</h3><p>ç¾éšæ®µä½¿ç”¨æœ¬æ©Ÿè¦†è“‹ç™»å…¥ç•«é¢ï¼ˆç„¡ Firebase Authï¼‰ã€‚</p></section>
</section></div></main>
<script src="./qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<script type="module">
  import { startApp } from './src/boot.js';
  startApp();
</script>

<script type="module">
  import { getCurrentEventId } from './src/core_firebase.js';

  const btnPublic = document.getElementById('btnPublicBoard');

  if (btnPublic) {
    btnPublic.addEventListener('click', (e) => {
      e.preventDefault();

      // Use the event currently selected in CMS
      const eid = getCurrentEventId();

      if (!eid) {
        alert('è«‹å…ˆåœ¨å·¦å´é¸æ“‡ä¸€å€‹æ´»å‹•ï¼ˆEventï¼‰å†é–‹å•Ÿ Public Board');
        return;
      }

      // Build URL: public.html?event=xxxx
      const url = new URL('./public.html', window.location.href);
      url.searchParams.set('event', eid);

      window.open(url.toString(), '_blank');  // open Public Board for this event
    });
  }
</script>

</body></html>
